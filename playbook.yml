---

- hosts: all
  become: yes

  tasks:
  - name: Install mongo
    ansible.builtin.yum:
      name: mongodb-org
      conf_file: /vagrant/mongodb-org-5.0.repo
  
  - name: Enable mongo
    ansible.builtin.systemd:
      name: mongod
      enabled: yes
      state: started

  - name: Add docker repo
    ansible.builtin.yum_repository:
      name: docker-ce
      description: Docker Repo
      baseurl: https://download.docker.com/linux/centos/8/x86_64/stable
      gpgcheck: yes
      gpgkey: https://download.docker.com/linux/centos/gpg

  - name: Install docker
    ansible.builtin.yum:
      name:
        - docker-ce
        - docker-ce-cli
        - containerd.io
  
  - name: Start docker
    ansible.builtin.systemd:
      name: docker
      state: started

  - name: Copy in app service
    ansible.builtin.copy:
      src: /vagrant/app.service
      dest: /etc/systemd/system

  - name: Start app service
    ansible.builtin.systemd:
      name: app
      enabled: yes
      state: started
      daemon-reload: yes
